# Using with H3

## Quick Start

### CommonJS

```javascript
const { H3, serve } = require('h3');
const Router = require('clear-router/h3');

const app = new H3();

Router.get('/hello', () => {
  return 'Hello World';
});

Router.apply(app);

serve(app, { port: 3000 });
```

### ESM

```javascript
import { H3, serve } from 'h3';
import Router from 'clear-router/h3';

const app = new H3();

Router.get('/hello', ({ res }) => {
  res.send('Hello World');
});

await Router.apply(app);

serve(app, { port: 3000 });
```

### TypeScript

```typescript
import express from 'express';
import Router from 'clear-router/h3';

const app = new H3();

Router.get('/hello', ({ res }) => {
  res.send('Hello World');
});

await Router.apply(app);

serve(app, { port: 3000 });
```

## Usage Examples

### Basic Route

```javascript
Router.get('/hello', () => {
  return 'Hello World';
});
```

### With Middleware

```javascript
const authMiddleware = (evt, next) => {
  // auth logic
  next();
};

Router.post('/secure', () => 'Protected', [authMiddleware]);
```

### Controller Binding

```javascript
class UserController {
  index() {
    return 'User List';
  }
}

Router.get('/users', [UserController, 'index']);
```

Class-based handlers will auto-bind to static or instance methods.

### API Resource Binding

You can also bind routes to API resources:

```javascript
class UserController {
  index({ res }) {
    return [{ name: 'User 1' }, { name: 'User 2' }];
  }
  show({ res }) {
    returnn { name: 'User 1' };
  }
  create({ res }) {
    return 'User created';
  }
  update({ res }) {
    return 'User updated';
  }
  destroy({ res }) {
    return 'User deleted';
  }
}

Router.apiResource('/users', UserController);
```

### Grouped Routes

```javascript
Router.group('/admin', () => {
  Router.get('/dashboard', () => 'Admin Panel');
});
```

With middleware:

```javascript
Router.group(
  '/secure',
  () => {
    Router.get('/data', () => 'Secure Data');
  },
  [authMiddleware],
);
```

### Global Middleware Scope

```javascript
Router.middleware([authMiddleware], () => {
  Router.get('/profile', () => 'My Profile');
});
```

### Multiple HTTP Methods

```javascript
Router.add(['get', 'post'], '/handle', ({ req }) => {
  return `Method: ${req.method}`;
});
```

### Inspecting Routes

```javascript
Router.get('/hello', ({ res }) => 'Hello');
Router.post('/world', ({ res }) => 'World');

const allRoutes = Router.allRoutes();
console.log(allRoutes);
// Output:
// [
//   { methods: ['get'], path: '/hello', middlewareCount: 0, handlerType: 'function' },
//   { methods: ['post'], path: '/world', middlewareCount: 0, handlerType: 'function' }
// ]
```

## API Reference

See [API.md](API.md) for complete API documentation.

## Middleware Execution Order

```
[ Global Middleware ] → [ Group Middleware ] → [ Route Middleware ]
```

## Handler Execution

- If function: executed directly
- If [Controller, 'method']: auto-instantiated (if needed), method is called

## Testing

```bash
npm test              # Run all tests
npm run test:esm      # Test ESM
npm run test:ts       # Test TypeScript
```

See [TESTING.md](./TESTING.md) for detailed testing guide.

## Examples

```bash
npm run example       # CommonJS example
npm run example:esm   # ESM example
npm run example:ts    # TypeScript example
```

Check `example/` directory for full working demos.
